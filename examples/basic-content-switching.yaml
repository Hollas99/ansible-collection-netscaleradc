- name: Sample Playbook | Generated by nscli_to_ansible_playbook.py
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Sample Playbook | snip
      delegate_to: localhost
      netscaler.adc.nsip:
        state: present

        ipaddress: 10.10.10.185
        netmask: 255.255.255.192
        type: SNIP

    - name: Sample Playbook | service-red-server
      delegate_to: localhost
      netscaler.adc.service:
        state: present

        name: svc-red-server
        ipaddress: 10.10.10.15
        servicetype: HTTP
        port: 80

    - name: Sample Playbook | service-green-server
      delegate_to: localhost
      netscaler.adc.service:
        state: present

        name: svc-green-server
        ipaddress: 10.10.10.166
        servicetype: HTTP
        port: 80

    - name: Sample Playbook | lbvserver-red-server
      delegate_to: localhost
      netscaler.adc.lbvserver:
        state: present

        name: lb-red-server
        servicetype: HTTP

        lbvserver_service_binding:
          mode: desired # desired | bind | unbind
          binding_members:
            - name: lb-red-server
              servicename: svc-red-server

    - name: Sample Playbook | lbvserver-green-server
      delegate_to: localhost
      netscaler.adc.lbvserver:
        state: present

        name: lb-green-server
        servicetype: HTTP

        lbvserver_service_binding:
          mode: desired # desired | bind | unbind
          binding_members:
            - name: lb-green-server
              servicename: svc-green-server

    # - name: Sample Playbook | red-server-service-lb-binding
    #   delegate_to: localhost
    #   netscaler.adc.lbvserver_service_binding:
    #     state: present

    #     name: lb-red-server
    #     servicename: svc-red-server

    # - name: Sample Playbook | green-server-service-lb-binding
    #   delegate_to: localhost
    #   netscaler.adc.lbvserver_service_binding:
    #     state: present

    #     name: lb-green-server
    #     servicename: svc-green-server

    - name: Sample Playbook | csaction-red-server
      delegate_to: localhost
      netscaler.adc.csaction:
        state: present

        name: csaction-red-server
        targetlbvserver: lb-red-server

    - name: Sample Playbook | csaction-green-server
      delegate_to: localhost
      netscaler.adc.csaction:
        state: present

        name: csaction-green-server
        targetlbvserver: lb-green-server

    - name: Sample Playbook | cspolicy-red-server
      delegate_to: localhost
      netscaler.adc.cspolicy:
        state: present

        policyname: cspolicy-red-server
        rule: "HTTP.REQ.URL.SET_TEXT_MODE(IGNORECASE).STARTSWITH(\"/red\")"
        action: csaction-red-server

    - name: Sample Playbook | cspolicy-green-server
      delegate_to: localhost
      netscaler.adc.cspolicy:
        state: present

        policyname: cspolicy-green-server
        rule: "HTTP.REQ.URL.SET_TEXT_MODE(IGNORECASE).STARTSWITH(\"/green\")"
        action: csaction-green-server

    - name: Sample Playbook | demo-csvserver
      delegate_to: localhost
      netscaler.adc.csvserver:
        state: enabled

        name: demo-csvserver
        servicetype: HTTP
        ipv46: 10.10.10.150
        port: 80

        csvserver_cspolicy_binding:
          mode: desired # desired | bind | unbind
          binding_members:
            - name: demo-csvserver
              policyname: cspolicy-red-server
              priority: 100
            - name: demo-csvserver
              policyname: cspolicy-green-server
              priority: 110

    # - name: Sample Playbook | red-csvserver-cspolicy-binding
    #   delegate_to: localhost
    #   netscaler.adc.csvserver_cspolicy_binding:
    #     state: present

    #     name: demo-csvserver
    #     policyname: cspolicy-red-server
    #     priority: 100

    # - name: Sample Playbook | green-csvserver-cspolicy-binding
    #   delegate_to: localhost
    #   netscaler.adc.csvserver_cspolicy_binding:
    #     state: present

    #     name: demo-csvserver
    #     policyname: cspolicy-green-server
    #     priority: 110
